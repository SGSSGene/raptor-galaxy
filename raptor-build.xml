<tool id="raptor-build" name="raptor build" version="2.0.0+3" python_template_version="3.5">
    <requirements>
        <requirement type="package" version="2.0.0">raptor</requirement>
    </requirements>
    <description>
        Builds an index to be used by `raptor search`.
    </description>
    <command detect_errors="exit_code"><![CDATA[
        echo "" > files.txt;
        #for $i, $s in enumerate($series)
            ln -s '${s.input}' genome${i}.fasta;
            echo genome${i}.fasta >> files.txt;
        #end for
        param=""
        #if $window
            param="\${param} --window ${window}"
        #end if
        raptor build files.txt --threads ${threads} --parts ${parts} --kmer ${kmer} --size ${size} --hash ${hash} \${param} ${compressed} ${compute_minimiser} ${disable_cutoffs} --output output.index;
    ]]></command>
    <inputs>
        <repeat name="series" title="Series">
            <param type="data" format="txt" name="input" />
        </repeat>
        <param name="threads" type="integer" value="1" min="1" label="The numer of threads to use. Default: 1. Value must be a positive integer. " />
        <param name="parts" type="integer" value="1" min="1" label="Splits the index in this many parts. Default: 1. Value must be a power of two." />
        <param name="window" type="integer" optional="true" min="1" label="The window size. Default: kmer size. Value must be a positive integer." />
        <param name="kmer" type="integer" value="20" min="1" max="32" label="The k-mer size. Default: 20. Value must be in range [1,32]." />
        <param name="size" type="text" value="1k" label="The size in bytes of the resulting index. Default: 1k. Must be an integer followed by [k,m,g,t] (case insensitive)." >
            <option value="1k">1k</option>
            <option value="1m">1m</option>
            <option value="1g">1g</option>
            <option value="1t">1t</option>
        </param>
        <param name="hash" type="integer" value="2" min="1" max="5" label="The number of hash functions to use. Default: 2. Value must be in range [1,5]." />
        <param name="compressed" type="boolean" truevalue="--compressed" falsevalue="" label="Build a compressed index." />
        <param name="compute_minimiser" type="boolean" truevalue="--compute-minimiser" falsevalue="" label="Computes minimisers using cutoffs from Mantis (Pandey et al.). Does not create the index." />
        <param name="disable_cutoffs" type="boolean" truevalue="--disable-cutoffs" falsevalue="" label="Do not apply cutoffs when using --compute-minimiser." />
    </inputs>
    <outputs>
        <data name="index" format="binary" from_work_dir="output.index" />
    </outputs>
    <tests>
        <test>
            <repeat name="series">
                <param name="input" value="genome0.fasta" />
            </repeat>
            <repeat name="series">
                <param name="input" value="genome1.fasta" />
            </repeat>
            <param name="kmer" value="2" />
            <param name="size" value="1k" />
            <output name="index" file="test_expected.index" />
        </test>
    </tests>

    <help><![CDATA[Raptor - A fast and space-efficient pre-filter for querying very large collections of nucleotide sequences.
    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{githubraptor,
  author = {LastTODO, FirstTODO},
  year = {TODO},
  title = {raptor},
  publisher = {GitHub},
  journal = {GitHub repository},
  url = {https://github.com/seqan/raptor},
}</citation>
    </citations>
</tool>
